import{I as v,l as y}from"./chunk-WACMVKXJ.js";import{d as g,e as s,o as u,r as l,s as d,z as f}from"./chunk-MSHI2ENP.js";var w=9007199254740991,b=class extends v{_data;_renderData=new s([]);_filter=new s("");_internalPageChanges=new g;_renderChangesSubscription=null;filteredData;get data(){return this._data.value}set data(e){e=Array.isArray(e)?e:[],this._data.next(e),this._renderChangesSubscription||this._filterData(e)}get filter(){return this._filter.value}set filter(e){this._filter.next(e),this._renderChangesSubscription||this._filterData(this.data)}get sort(){return this._sort}set sort(e){this._sort=e,this._updateChangeSubscription()}_sort;get paginator(){return this._paginator}set paginator(e){this._paginator=e,this._updateChangeSubscription()}_paginator;sortingDataAccessor=(e,t)=>{let a=e[t];if(y(a)){let r=Number(a);return r<w?r:a}return a};sortData=(e,t)=>{let a=t.active,r=t.direction;return!a||r==""?e:e.sort((c,m)=>{let i=this.sortingDataAccessor(c,a),o=this.sortingDataAccessor(m,a),h=typeof i,p=typeof o;h!==p&&(h==="number"&&(i+=""),p==="number"&&(o+=""));let n=0;return i!=null&&o!=null?i>o?n=1:i<o&&(n=-1):i!=null?n=1:o!=null&&(n=-1),n*(r=="asc"?1:-1)})};filterPredicate=(e,t)=>{let a=t.trim().toLowerCase();return Object.values(e).some(r=>`${r}`.toLowerCase().includes(a))};constructor(e=[]){super(),this._data=new s(e),this._updateChangeSubscription()}_updateChangeSubscription(){let e=this._sort?f(this._sort.sortChange,this._sort.initialized):u(null),t=this._paginator?f(this._paginator.page,this._internalPageChanges,this._paginator.initialized):u(null),a=this._data,r=d([a,this._filter]).pipe(l(([i])=>this._filterData(i))),c=d([r,e]).pipe(l(([i])=>this._orderData(i))),m=d([c,t]).pipe(l(([i])=>this._pageData(i)));this._renderChangesSubscription?.unsubscribe(),this._renderChangesSubscription=m.subscribe(i=>this._renderData.next(i))}_filterData(e){return this.filteredData=this.filter==null||this.filter===""?e:e.filter(t=>this.filterPredicate(t,this.filter)),this.paginator&&this._updatePaginator(this.filteredData.length),this.filteredData}_orderData(e){return this.sort?this.sortData(e.slice(),this.sort):e}_pageData(e){if(!this.paginator)return e;let t=this.paginator.pageIndex*this.paginator.pageSize;return e.slice(t,t+this.paginator.pageSize)}_updatePaginator(e){Promise.resolve().then(()=>{let t=this.paginator;if(t&&(t.length=e,t.pageIndex>0)){let a=Math.ceil(t.length/t.pageSize)-1||0,r=Math.min(t.pageIndex,a);r!==t.pageIndex&&(t.pageIndex=r,this._internalPageChanges.next())}})}connect(){return this._renderChangesSubscription||this._updateChangeSubscription(),this._renderData}disconnect(){this._renderChangesSubscription?.unsubscribe(),this._renderChangesSubscription=null}};export{b as a};
