import{a as M}from"./chunk-K7ACIKUK.js";import{a as ee}from"./chunk-ZHXSHU6C.js";import{F as K,G as Q,N as X,O as Y,wd as Z}from"./chunk-2BYPWJHQ.js";import"./chunk-WACMVKXJ.js";import"./chunk-2QSN2QZ4.js";import"./chunk-G2XYFENO.js";import{a as j}from"./chunk-A6GTVXL6.js";import{b as B,d as U,i as $,n as G,t as J,u as H,v as q}from"./chunk-KCCW6LK5.js";import{a as O}from"./chunk-KV7E3DUU.js";import{$a as E,Gc as z,Ja as s,Kb as r,Lb as h,Mb as A,Oa as C,Ob as k,Qb as _,Rb as D,Sb as b,Ub as y,Wa as R,Wc as V,Xa as w,Xc as W,Y as x,Zc as I,db as d,ga as v,ha as S,ob as i,pb as a,qb as p,tc as T,ub as P,uc as L,vc as F,wb as g,xb as c}from"./chunk-MSHI2ENP.js";import"./chunk-EQDQRRRY.js";var N=()=>({standalone:!0});function ne(o,u){o&1&&(i(0,"div",31)(1,"div",32)(2,"span",33),r(3,"Loading..."),a()(),i(4,"p",34),r(5,"Loading data..."),a()())}function re(o,u){if(o&1&&(i(0,"div",35),p(1,"i",36),r(2),a()),o&2){let e=c();s(2),A(" ",e.errorMessage," ")}}function oe(o,u){o&1&&(i(0,"div",31),p(1,"i",37),i(2,"p",38),r(3,"No reservations found"),a()())}function se(o,u){if(o&1&&(i(0,"span"),r(1),a()),o&2){let e=c().$implicit;s(),h(e.customerName)}}function le(o,u){o&1&&(i(0,"span",58),r(1,"Not assigned"),a())}function me(o,u){if(o&1){let e=P();i(0,"tr")(1,"td")(2,"div",52)(3,"input",53),b("ngModelChange",function(t){let m=v(e).$implicit;return D(m.isSelected,t)||(m.isSelected=t),S(t)}),g("ngModelChange",function(){let t=v(e).$implicit,m=c(2);return S(m.selectItem(t))}),a()()(),i(4,"td")(5,"h6",54),r(6),a()(),i(7,"td")(8,"div",55)(9,"div",56)(10,"span",57),r(11),a()(),i(12,"div")(13,"h6",54),r(14),a(),i(15,"small",58),r(16),a()()()(),i(17,"td"),E(18,se,2,1,"span",59)(19,le,2,0,"span",60),a(),i(20,"td"),r(21),a(),i(22,"td")(23,"span",61),r(24),a()(),i(25,"td"),r(26),a(),i(27,"td")(28,"span",62),r(29),a()(),i(30,"td")(31,"div",63)(32,"a",64),p(33,"i",65),a(),i(34,"ul",66)(35,"li")(36,"a",67),g("click",function(){let t=v(e).$implicit,m=c(2);return S(m.navigateToReservationDetails(t,"view"))}),p(37,"i",68),r(38,"View Details"),a()()()()()()}if(o&2){let e=u.$implicit,n=c(2);s(3),_("ngModel",e.isSelected),s(3),h(e.carName),s(5),h(e.viewerName.charAt(0)),s(3),h(e.viewerName),s(2),h(e.viewerEmail),s(2),d("ngIf",e.customerId),s(),d("ngIf",!e.customerId),s(2),h(e.meetingAddress),s(3),h(n.formatPrice(e.estimatedPrice)),s(2),h(e.createdDate),s(2),d("ngClass",n.getStatusClass(e.status)),s(),A(" ",e.status," ")}}function de(o,u){if(o&1){let e=P();i(0,"table",39),g("matSortChange",function(t){v(e);let m=c();return S(m.sortData(t))}),i(1,"thead",40)(2,"tr")(3,"th",41)(4,"div",42),g("click",function(){v(e);let t=c();return S(t.selectAll(t.initChecked))}),i(5,"input",43),b("ngModelChange",function(t){v(e);let m=c();return D(m.initChecked,t)||(m.initChecked=t),S(t)}),a()()(),i(6,"th",44),r(7,"CAR"),a(),i(8,"th",45),r(9,"VIEWER"),a(),i(10,"th",46),r(11,"CUSTOMER"),a(),i(12,"th",47),r(13,"MEETING ADDRESS"),a(),i(14,"th",48),r(15,"PRICE"),a(),i(16,"th",49),r(17,"CREATED DATE"),a(),i(18,"th",50),r(19,"STATUS"),a(),p(20,"th"),a()(),i(21,"tbody"),E(22,me,39,12,"tr",51),a()()}if(o&2){let e=c();s(5),_("ngModel",e.initChecked),s(17),d("ngForOf",e.tableData)}}function ce(o,u){if(o&1&&(i(0,"div",69)(1,"div",70),r(2),a(),i(3,"div",71),p(4,"app-custom-pagination"),a()()),o&2){let e=c();s(2),k(" Showing ",e.currentPage*e.pageSize+1," to ",e.Math.min((e.currentPage+1)*e.pageSize,e.totalData)," of ",e.totalData," entries ")}}var ie=(()=>{class o{convertDateFormat(e){if(!e)return"";let n=e.split("-");return n.length===3?`${n[2]}/${n[1]}/${n[0]}`:e}constructor(e,n,t,m){this.data=e,this.router=n,this.pagination=t,this.apiService=m,this.routes=O,this.initChecked=!1,this.pageSize=5,this.tableData=[],this.tableDataCopy=[],this.actualData=[],this.currentPage=0,this.skip=0,this.limit=this.pageSize,this.serialNumberArray=[],this.totalData=0,this.showFilter=!1,this.pageSelection=[],this.searchDataValue="",this.sortBy="",this.fromDate="",this.toDate="",this.status="",this.isLoading=!1,this.errorMessage="",this.hasError=!1,this.originalApiData=[],this.totalPages=0,this.Math=Math,this.isUpdatingPagination=!1,this.pagination.tablePageSize.subscribe(l=>{if(this.isUpdatingPagination)return;let f=Math.floor(l.skip/this.pageSize);f!==this.currentPage&&f>=0&&(this.currentPage=f,this.loadData())})}ngOnInit(){this.loadData()}getTableData(e){this.currentPage=Math.floor(e.skip/this.pageSize),this.loadData()}loadData(){this.isLoading=!0,this.hasError=!1,this.errorMessage="";let e={page:this.currentPage,sortBy:this.sortBy||"Descending",fromDate:this.convertDateFormat(this.fromDate),toDate:this.convertDateFormat(this.toDate),status:this.status,pageSize:this.pageSize};this.apiService.getReservationsFilter(e).subscribe({next:n=>{this.isLoading=!1,this.tableData=[],this.tableDataCopy=[],this.serialNumberArray=[],n&&n.data&&Array.isArray(n.data)?(this.totalData=n.totalCount||n.data.length,this.actualData=n.data,this.originalApiData=n.data,n.data.forEach((t,m)=>{let l=this.currentPage*this.pageSize+m+1,f={sNo:l,id:t.id,carId:t.carId,carMake:t.carMake||"N/A",carModel:t.carModel||"",carName:`${t.carMake||""} ${t.carModel||""}`.trim()||"N/A",customerId:t.customerId,customerFirstName:t.customerFirstName||"",customerLastName:t.customerLastName||"",customerName:t.customerId?`${t.customerFirstName||""} ${t.customerLastName||""}`.trim():"N/A",viewerId:t.viewerId,viewerFirstName:t.viewerFirstName||"",viewerLastName:t.viewerLastName||"",viewerEmail:t.viewerEmail||"",viewerName:`${t.viewerFirstName||""} ${t.viewerLastName||""}`.trim()||"N/A",meetingAddress:t.meetingAddress||"N/A",meetingDate:t.meetingDate?new Date(t.meetingDate).toLocaleDateString():"N/A",scheduledAt:t.scheduledAt?new Date(t.scheduledAt).toLocaleString():"N/A",estimatedPrice:t.estimatedPrice||0,notes:t.notes||"",status:t.status||"N/A",createdDate:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A",createdAt:t.createdAt,isSelected:!1,originalData:t};this.tableData.push(f),this.tableDataCopy.push(f),this.serialNumberArray.push(l)}),this.dataSource=new M(this.tableData),this.isUpdatingPagination=!0,this.pagination.calculatePageSize.next({totalData:this.totalData,pageSize:this.pageSize,tableData:this.tableData,serialNumberArray:this.serialNumberArray}),this.skip=this.currentPage*this.pageSize,this.pagination.tablePageSize.next({skip:this.skip,limit:this.limit,pageSize:this.pageSize}),setTimeout(()=>{this.isUpdatingPagination=!1},0)):(this.totalData=0,this.actualData=[],this.originalApiData=[],this.dataSource=new M([]),this.isUpdatingPagination=!0,this.pagination.calculatePageSize.next({totalData:0,pageSize:this.pageSize,tableData:[],serialNumberArray:[]}),this.skip=this.currentPage*this.pageSize,this.pagination.tablePageSize.next({skip:this.skip,limit:this.limit,pageSize:this.pageSize}),setTimeout(()=>{this.isUpdatingPagination=!1},0))},error:n=>{this.isLoading=!1,this.hasError=!0,this.errorMessage="Failed to load reservations data. Please try again.",this.totalData=0,this.actualData=[],this.originalApiData=[],this.dataSource=new M([]),console.error("Error loading reservations data:",n)}})}searchData(e){e==""?this.tableData=this.tableDataCopy:(this.dataSource.filter=e.trim().toLowerCase(),this.tableData=this.dataSource.filteredData)}sortData(e){let n=this.tableData.slice();!e.active||e.direction===""?this.tableData=n:this.tableData=n.sort((t,m)=>{let l=t[e.active],f=m[e.active];return(l<f?-1:1)*(e.direction==="asc"?1:-1)})}changePageSize(e){this.pageSelection=[];let n=Math.min(e,5);this.limit=n,this.skip=0,this.currentPage=0,this.pageSize=n,this.loadData()}onPageChange(e){this.currentPage=e,this.loadData()}applyFilters(){this.currentPage=0,this.loadData()}clearFilters(){this.sortBy="",this.fromDate="",this.toDate="",this.status="",this.currentPage=0,this.loadData()}onSortChange(e){e!==null&&(this.sortBy=e,this.currentPage=0,this.loadData())}onStatusChange(e){this.status=e||"",this.currentPage=0,this.loadData()}navigateToReservationDetails(e,n){if(e.originalData){let t={tableData:e,originalData:e.originalData};sessionStorage.setItem("currentReservationData",JSON.stringify(t)),this.router.navigate(["/admin/reservation-details",e.id||e.originalData.id,n])}else sessionStorage.setItem("currentReservationData",JSON.stringify(e)),this.router.navigate(["/admin/reservation-details",e.id||e.sNo,n])}selectItem(e){}deleteReservation(e){console.log("Delete reservation:",e)}onPageSizeChange(e){this.pageSize=Math.min(e,5),this.currentPage=0,this.loadData()}selectAll(e){e?this.tableData.forEach(n=>{n.isSelected=!1}):this.tableData.forEach(n=>{n.isSelected=!0})}formatPrice(e){return e?`$${e.toFixed(2)}`:"N/A"}getStatusClass(e){switch(e?.toUpperCase()){case"CONFIRMED":return"bg-success";case"PENDING":return"bg-warning";case"NEW":return"bg-info";case"CANCELLED":case"REJECTED":return"bg-danger";case"COMPLETED":return"bg-primary";default:return"bg-secondary"}}static{this.\u0275fac=function(n){return new(n||o)(C(j),C(V),C(X),C(ee))}}static{this.\u0275cmp=R({type:o,selectors:[["app-reservations"]],standalone:!1,decls:60,vars:18,consts:[[1,"content","me-4"],[1,"d-md-flex","d-block","align-items-center","justify-content-between","page-breadcrumb","mb-3"],[1,"my-auto","mb-2"],[1,"mb-1"],[1,"breadcrumb","mb-0"],[1,"breadcrumb-item"],[3,"routerLink"],["aria-current","page",1,"breadcrumb-item","active"],[1,"filter-form","mb-3","p-3","bg-light","rounded"],[1,"row","g-3","align-items-end"],[1,"col-md-2"],[1,"form-label"],["type","date",1,"form-control",3,"ngModelChange","ngModel","ngModelOptions"],[1,"form-select",3,"ngModelChange","change","ngModel","ngModelOptions"],["value","Descending"],["value","Ascending"],["value",""],["value","NEW"],["value","PENDING"],["value","CONFIRMED"],["value","COMPLETED"],["value","CANCELLED"],["type","button",1,"btn","btn-primary","w-100",3,"click"],[1,"ti","ti-search","me-1"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],[1,"ti","ti-x","me-1"],[1,"custom-datatable-filter","table-responsive"],["class","text-center p-4",4,"ngIf"],["class","alert alert-danger text-center p-4",4,"ngIf"],["matSort","","class","table datatable",3,"matSortChange",4,"ngIf"],["class","d-flex justify-content-between align-items-center mt-3",4,"ngIf"],[1,"text-center","p-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"alert","alert-danger","text-center","p-4"],[1,"ti","ti-alert-circle","me-2"],[1,"ti","ti-database-off","text-muted",2,"font-size","3rem"],[1,"mt-2","text-muted"],["matSort","",1,"table","datatable",3,"matSortChange"],[1,"thead-light"],[1,"no-sort"],[1,"form-check","form-check-md",3,"click"],["type","checkbox","id","select-all",1,"form-check-input",3,"ngModelChange","ngModel"],["mat-sort-header","carName"],["mat-sort-header","viewerName"],["mat-sort-header","customerName"],["mat-sort-header","meetingAddress"],["mat-sort-header","estimatedPrice"],["mat-sort-header","createdDate"],["mat-sort-header","status"],[4,"ngFor","ngForOf"],[1,"form-check","form-check-md"],["type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel"],[1,"mb-0"],[1,"d-flex","align-items-center"],[1,"avatar","avatar-sm","me-2"],[1,"avatar-initial","rounded-circle","bg-primary","w-100","d-flex","align-items-center","justify-content-center"],[1,"text-muted"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"fw-semibold"],[1,"badge",3,"ngClass"],[1,"dropdown"],["href","javascript:void(0);","data-bs-toggle","dropdown",1,"btn","btn-white","btn-sm"],[1,"ti","ti-dots-vertical"],[1,"dropdown-menu"],["href","javascript:void(0);",1,"dropdown-item","rounded-1",3,"click"],[1,"ti","ti-eye","me-1"],[1,"d-flex","justify-content-between","align-items-center","mt-3"],[1,"dataTables_info"],[1,"dataTables_paginate"]],template:function(n,t){n&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),r(4,"All Reservations"),a(),i(5,"nav")(6,"ol",4)(7,"li",5)(8,"a",6),r(9,"Home"),a()(),i(10,"li",7),r(11,"All Reservations"),a()()()()(),i(12,"div",8)(13,"div",9)(14,"div",10)(15,"label",11),r(16,"From Date"),a(),i(17,"input",12),b("ngModelChange",function(l){return D(t.fromDate,l)||(t.fromDate=l),l}),a()(),i(18,"div",10)(19,"label",11),r(20,"To Date"),a(),i(21,"input",12),b("ngModelChange",function(l){return D(t.toDate,l)||(t.toDate=l),l}),a()(),i(22,"div",10)(23,"label",11),r(24,"Sort By"),a(),i(25,"select",13),b("ngModelChange",function(l){return D(t.sortBy,l)||(t.sortBy=l),l}),g("change",function(l){return t.onSortChange(l.target.value)}),i(26,"option",14),r(27,"Descending"),a(),i(28,"option",15),r(29,"Ascending"),a()()(),i(30,"div",10)(31,"label",11),r(32,"Status"),a(),i(33,"select",13),b("ngModelChange",function(l){return D(t.status,l)||(t.status=l),l}),g("change",function(l){return t.onStatusChange(l.target.value)}),i(34,"option",16),r(35,"All"),a(),i(36,"option",17),r(37,"New"),a(),i(38,"option",18),r(39,"Pending"),a(),i(40,"option",19),r(41,"Confirmed"),a(),i(42,"option",20),r(43,"Completed"),a(),i(44,"option",21),r(45,"Cancelled"),a()()(),i(46,"div",10)(47,"button",22),g("click",function(){return t.applyFilters()}),p(48,"i",23),r(49," Search "),a()(),i(50,"div",10)(51,"button",24),g("click",function(){return t.clearFilters()}),p(52,"i",25),r(53," Clear "),a()()()(),i(54,"div",26),E(55,ne,6,0,"div",27)(56,re,3,1,"div",28)(57,oe,4,0,"div",27)(58,de,23,2,"table",29),a(),E(59,ce,5,3,"div",30),a()),n&2&&(s(8),d("routerLink",t.routes.homeNew),s(9),_("ngModel",t.fromDate),d("ngModelOptions",y(14,N)),s(4),_("ngModel",t.toDate),d("ngModelOptions",y(15,N)),s(4),_("ngModel",t.sortBy),d("ngModelOptions",y(16,N)),s(8),_("ngModel",t.status),d("ngModelOptions",y(17,N)),s(22),d("ngIf",t.isLoading),s(),d("ngIf",t.hasError),s(),d("ngIf",!t.isLoading&&!t.hasError&&t.totalData===0),s(),d("ngIf",!t.isLoading&&!t.hasError&&t.totalData>0),s(),d("ngIf",!t.isLoading&&!t.hasError&&t.totalData>0))},dependencies:[T,L,F,W,H,q,U,B,J,$,G,K,Q,Y],encapsulation:2})}}return o})();var pe=[{path:"",component:ie}],ae=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=w({type:o})}static{this.\u0275inj=x({imports:[I.forChild(pe),I]})}}return o})();var Re=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=w({type:o})}static{this.\u0275inj=x({imports:[z,ae,Z]})}}return o})();export{Re as ReservationsModule};
