import{a as he}from"./chunk-NRINXQYY.js";import{a as pe}from"./chunk-ZHXSHU6C.js";import{H as de,wd as me}from"./chunk-2BYPWJHQ.js";import"./chunk-WACMVKXJ.js";import"./chunk-2QSN2QZ4.js";import{a as ce}from"./chunk-G2XYFENO.js";import"./chunk-A6GTVXL6.js";import"./chunk-KCCW6LK5.js";import{a as le}from"./chunk-KV7E3DUU.js";import{$a as C,Db as Z,Eb as G,Fa as I,Fb as ee,Fc as ne,Gc as re,Ja as s,Kb as o,Lb as w,Mb as E,Nb as j,Oa as P,Ob as te,Wa as H,Wc as se,Xa as N,Xc as oe,Y as J,Zc as B,ac as z,cc as $,db as l,fb as Q,ga as V,ha as K,hb as Y,ob as n,pb as i,qb as u,ub as X,uc as ae,vc as ie,wb as q,xb as h}from"./chunk-MSHI2ENP.js";import{a as T,b as R}from"./chunk-EQDQRRRY.js";var ve=["chart"];function xe(a,d){if(a&1&&(n(0,"h3"),o(1),i()),a&2){let e=h();s(),w(e.totalCars)}}function ye(a,d){a&1&&(n(0,"h3"),o(1,"..."),i())}function Ce(a,d){if(a&1&&(n(0,"h5",3),o(1),i()),a&2){let e=h();s(),w(e.totalReservations)}}function be(a,d){a&1&&(n(0,"h5",3),o(1,"..."),i())}function _e(a,d){if(a&1&&(n(0,"p")(1,"span",48),o(2),i(),o(3," Last Week "),i()),a&2){let e=h();s(),Y(e.reservationPercentageChange>=0?"text-success":"text-danger"),s(),j(" ",e.reservationPercentageChange>=0?"+":"","",e.reservationPercentageChange,"% ")}}function Se(a,d){a&1&&(n(0,"p"),o(1,"Loading..."),i())}function we(a,d){if(a&1&&(n(0,"h5",3),o(1),i()),a&2){let e=h();s(),w(e.totalCustomers)}}function De(a,d){a&1&&(n(0,"h5",3),o(1,"..."),i())}function Ee(a,d){a&1&&(n(0,"p"),o(1,"Loading..."),i())}function Ae(a,d){if(a&1&&(n(0,"h5",3),o(1),i()),a&2){let e=h();s(),w(e.totalCars)}}function ke(a,d){a&1&&(n(0,"h5",3),o(1,"..."),i())}function Le(a,d){if(a&1&&(n(0,"p")(1,"span",49),o(2),i(),o(3," Last Week "),i()),a&2){let e=h();s(),Q("text-success",e.carPercentageChange>=0)("text-danger",e.carPercentageChange<0),s(),j(" ",e.carPercentageChange>=0?"+":"","",e.carPercentageChange,"% ")}}function Ie(a,d){a&1&&(n(0,"p"),o(1,"Loading..."),i())}function Te(a,d){if(a&1&&(n(0,"div",50),u(1,"img",51),i()),a&2){let e=h();s(),l("src",e.newlyAddedCar.carImage||"assets/admin/assets/img/car/car.jpg",I)}}function Re(a,d){a&1&&(n(0,"div",50)(1,"div",52)(2,"span"),o(3,"Loading..."),i()()())}function Je(a,d){a&1&&(n(0,"div",50)(1,"div",52)(2,"span"),o(3,"No cars available"),i()()())}function Pe(a,d){if(a&1&&(n(0,"h6",54),o(1),z(2,"number"),n(3,"span",56),o(4,"/day"),i()()),a&2){let e=h(2);s(),E(" $",$(2,1,e.newlyAddedCar.estimatedPrice,"1.0-0")," ")}}function Ne(a,d){if(a&1&&(n(0,"div",36)(1,"div")(2,"p",53),o(3),i(),n(4,"h6",54),o(5),i()(),C(6,Pe,5,4,"h6",55),i()),a&2){let e=h();s(3),w(e.newlyAddedCar.bodyType||"N/A"),s(2),te("",e.newlyAddedCar.make||""," ",e.newlyAddedCar.model||""," ",e.newlyAddedCar.trim||"",""),s(),l("ngIf",e.newlyAddedCar.estimatedPrice)}}function Me(a,d){if(a&1&&(n(0,"div",57)(1,"div",58)(2,"div",59)(3,"h6",54),o(4,"Fuel Type"),i(),n(5,"span",60),o(6),i()()(),n(7,"div",58)(8,"div",59)(9,"h6",54),o(10,"Passengers"),i(),n(11,"span",60),o(12),i()()(),n(13,"div",58)(14,"div",59)(15,"h6",54),o(16,"Driving Type"),i(),n(17,"span",60),o(18),i()()()()),a&2){let e=h();s(6),w(e.newlyAddedCar.fuelType||"N/A"),s(6),w(e.newlyAddedCar.doors||"N/A"),s(6),w(e.newlyAddedCar.transmission||"N/A")}}function Fe(a,d){if(a&1){let e=X();n(0,"a",61),q("click",function(){V(e);let t=h();return K(t.navigateToCarDetails())}),o(1,"View Details"),u(2,"i",62),i()}}function We(a,d){a&1&&(n(0,"div",63)(1,"span"),o(2,"Loading car details..."),i()())}function je(a,d){a&1&&(n(0,"div",63)(1,"span"),o(2,"No cars available"),i()())}function ze(a,d){if(a&1&&(n(0,"span"),o(1),i()),a&2){let e=h().$implicit;s(),E(" ",e.carDetails.transmission," ")}}function $e(a,d){a&1&&(n(0,"span"),o(1," N/A "),i())}function Be(a,d){if(a&1&&(n(0,"div",77)(1,"h6",54),o(2),i()()),a&2){let e=h().$implicit;s(2),w(e.meetingAddress)}}function Ue(a,d){a&1&&(n(0,"div",77)(1,"h6",54),o(2,"N/A"),i()())}function Oe(a,d){if(a&1&&(n(0,"p",78),o(1),i()),a&2){let e=h().$implicit,r=h(2);s(),E(" ",r.formatDate(e.scheduledAt)," ")}}function Ve(a,d){if(a&1&&(n(0,"p",78),o(1),i()),a&2){let e=h().$implicit,r=h(2);s(),E(" ",r.formatDate(e.createdAt)," ")}}function Ke(a,d){a&1&&(n(0,"p",78),o(1," N/A "),i())}function He(a,d){if(a&1&&(n(0,"h6",54),o(1),z(2,"number"),n(3,"span",79),o(4,"/day"),i()()),a&2){let e=h().$implicit;s(),E(" $",$(2,1,e.estimatedPrice,"1.0-0")," ")}}function Qe(a,d){a&1&&(n(0,"h6",54),o(1," N/A "),i())}function Ye(a,d){if(a&1&&(n(0,"tr")(1,"td")(2,"div",24)(3,"a",66),u(4,"img",67),i(),n(5,"div",68)(6,"p",69),C(7,ze,2,1,"span",15)(8,$e,2,0,"span",15),u(9,"i",70),o(10,"Self "),i(),n(11,"h6",71)(12,"a",6),o(13),i()()()()(),n(14,"td"),C(15,Be,3,1,"div",72)(16,Ue,3,0,"div",72)(17,Oe,2,1,"p",73)(18,Ve,2,1,"p",73)(19,Ke,2,0,"p",73),i(),n(20,"td")(21,"div",74),C(22,He,5,4,"h6",55)(23,Qe,2,0,"h6",55),n(24,"a",75),u(25,"img",76),i()()()()),a&2){let e=d.$implicit,r=h(2);s(3),l("routerLink",r.routes.carDetails),s(),l("src",r.getCarImage(e.carMake),I),s(3),l("ngIf",e.carDetails&&e.carDetails.transmission),s(),l("ngIf",!e.carDetails||!e.carDetails.transmission),s(4),l("routerLink",r.routes.carDetails),s(),E(" ",e.carDetails?e.carDetails.make+" "+(e.carDetails.model||""):e.carMake||"N/A"," "),s(2),l("ngIf",e.meetingAddress),s(),l("ngIf",!e.meetingAddress),s(),l("ngIf",e.scheduledAt),s(),l("ngIf",!e.scheduledAt&&e.createdAt),s(),l("ngIf",!e.scheduledAt&&!e.createdAt),s(3),l("ngIf",e.estimatedPrice),s(),l("ngIf",!e.estimatedPrice),s(2),l("src",r.getCustomerAvatar(),I)}}function Xe(a,d){if(a&1&&(n(0,"table",64),C(1,Ye,26,14,"tr",65),i()),a&2){let e=h();s(),l("ngForOf",e.recentReservations)}}function qe(a,d){a&1&&(n(0,"div",80)(1,"span"),o(2,"Loading reservations..."),i()())}function Ze(a,d){a&1&&(n(0,"div",80)(1,"span"),o(2,"No reservations available"),i()())}function Ge(a,d){if(a&1&&(n(0,"tr")(1,"td")(2,"div",24)(3,"a",66),u(4,"img",81),i(),n(5,"div",68)(6,"h6",71)(7,"a",6),o(8),i()(),n(9,"span",82),o(10,"Client"),i()()()(),n(11,"td",83)(12,"p",84),o(13,"No of Bookings"),i(),n(14,"h6",54),o(15),i()()()),a&2){let e=d.$implicit,r=h(2);s(3),l("routerLink",r.routes.customerDetails),s(),l("src",r.getCustomerAvatar(),I),s(3),l("routerLink",r.routes.customerDetails),s(),E(" ",(e.firstName||"")+" "+(e.lastName||"")||"N/A"," "),s(7),w(e.bookingCount||0)}}function et(a,d){if(a&1&&(n(0,"table",64),C(1,Ge,16,5,"tr",65),i()),a&2){let e=h();s(),l("ngForOf",e.recentCustomers)}}function tt(a,d){a&1&&(n(0,"div",80)(1,"span"),o(2,"Loading customers..."),i()())}function at(a,d){a&1&&(n(0,"div",80)(1,"span"),o(2,"No customers available"),i()())}var fe=(()=>{class a{constructor(e,r,t){this.authService=e,this.apiService=r,this.router=t,this.routes=le,this.bounds=new google.maps.LatLngBounds,this.current=0,this.salesStatistics={series:[]},this.statistics_chart={series:[]},this.planOverview={series:[]},this.Areachart={series:[]},this.Areachart2={series:[]},this.Areachart3={series:[]},this.bsValue=new Date,this.maxDate=new Date,this.userName="User",this.totalCars=0,this.isLoadingCars=!1,this.carPercentageChange=0,this.totalReservations=0,this.reservationPercentageChange=0,this.isLoadingReservations=!1,this.totalCustomers=0,this.isLoadingCustomers=!1,this.newlyAddedCar=null,this.isLoadingNewCar=!1,this.recentReservations=[],this.isLoadingRecentReservations=!1,this.recentCustomers=[],this.isLoadingRecentCustomers=!1,this.locations=[{id:1,car_name:"Ford Endeavour",speciality:"Speed : 20/Kms",lat:53.470692,lng:-2.220328,profile_link:"car-details.html",image:"assets/admin/assets/img/car/car-01.jpg"},{id:2,car_name:"Ferrari 458 MM",speciality:"Speed : 25/Kms",address:"Newyork, USA",lat:53.469189,lng:-2.199262,profile_link:"car-details.html",image:"assets/admin/assets/img/car/car-02.jpg"},{id:3,car_name:"Ford Mustang ",speciality:"Speed : 19/Kms",lat:53.468665,lng:-2.189269,profile_link:"car-details.html",image:"assets/admin/assets/img/car/car-03.jpg"},{id:4,car_name:"Toyota Tacoma 4",speciality:"Speed : 20/Kms",lat:53.463894,lng:-2.17788,profile_link:"car-details.html",image:"assets/admin/assets/img/car/car-04.jpg"},{id:5,car_name:"Chevrolet Pick Truck",speciality:"Speed : 20/Kms",lat:53.466359,lng:-2.213314,profile_link:"car-details.html",image:"assets/admin/assets/img/car/car-05.jpg"},{id:6,car_name:"Etios Carmen",speciality:"Speed : 20/Kms",lat:53.463906,lng:-2.213271,profile_link:"car-details.html",image:"assets/admin/assets/img/car/car-06.jpg"},{id:7,car_name:"Kia Soul 2016",speciality:"Speed : 20/Kms",lat:53.461974,lng:-2.210661,profile_link:"car-details.html",image:"assets/admin/assets/img/car/car-07.jpg"},{id:8,car_name:"Chevrolet Camaro",speciality:"Speed : 20/Kms",lat:53.458785,lng:-2.188532,profile_link:"car-details.html",image:"assets/admin/assets/img/car/car-08.jpg"},{id:9,car_name:"Toyota Camry SE 350",speciality:"Speed : 20/Kms",lat:53.4558571,lng:-2.1950372,profile_link:"car-details.html",image:"assets/admin/assets/img/car/car-09.jpg"}],this.maxDate.setDate(this.maxDate.getDate()+7),this.bsRangeValue=[this.bsValue,this.maxDate]}ngOnInit(){this.loadUserInfo(),this.loadCarCount(),this.loadReservationStats(),this.loadCustomerCount(),this.loadNewlyAddedCar(),this.loadRecentReservations(),this.loadRecentCustomers(),this.Areachart={series:[{name:"Net Profit",data:[9,4,7,7,4,9,8]}],chart:{type:"bar",width:70,toolbar:{show:!1},zoom:{enabled:!1},dropShadow:{enabled:!0,top:3,left:14,blur:4,opacity:.12,color:"#f7a1a1"},sparkline:{enabled:!0}},markers:{size:0,colors:["#f7a1a1"],strokeColors:"#f7a1a1",strokeWidth:2,hover:{size:7}},plotOptions:{bar:{horizontal:!1,columnWidth:"35%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2.5,curve:"smooth"},colors:["#D0E3E6"],xaxis:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul"],labels:{show:!1}},tooltip:{show:!1,theme:"light",fixed:{enabled:!1},x:{show:!0},marker:{show:!0}}},this.Areachart3={series:[{name:"Net Profit",data:[9,4,7,7,4,9,8]}],chart:{type:"bar",width:70,toolbar:{show:!1},zoom:{enabled:!1},dropShadow:{enabled:!1,top:3,left:14,blur:4,opacity:.12,color:"#fff"},sparkline:{enabled:!0}},markers:{size:0,colors:["#f7a1a1"],strokeColors:"#fff",strokeWidth:2,hover:{size:7}},plotOptions:{bar:{horizontal:!1,columnWidth:"35%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2.5,curve:"smooth"},colors:["#F0ECFF"],xaxis:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul"],labels:{show:!1}},tooltip:{show:!1,theme:"light",fixed:{enabled:!1},x:{show:!0},marker:{show:!0}}},this.Areachart2={series:[{name:"Net Profit",data:[9,4,7,7,4,9,8]}],chart:{type:"bar",width:70,toolbar:{show:!1},zoom:{enabled:!1},dropShadow:{enabled:!1,top:3,left:14,blur:4,opacity:.12,color:"#fff"},sparkline:{enabled:!0}},markers:{size:0,colors:["#f7a1a1"],strokeColors:"#fff",strokeWidth:2,hover:{size:7}},plotOptions:{bar:{horizontal:!1,columnWidth:"35%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2.5,curve:"smooth"},colors:["#FFF3EB"],xaxis:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul"],labels:{show:!1}},tooltip:{show:!1,theme:"light",fixed:{enabled:!1},x:{show:!0},marker:{show:!0}}},this.salesStatistics={series:[{name:"Revenue",data:[22,22,28,25,15,22,20]},{name:"Expenses",data:[-9,-25,-5,-10,-10,-25,-5]}],grid:{padding:{top:5,right:5}},colors:["#FFA633","#FFDBAD"],chart:{type:"bar",height:290,stacked:!0,zoom:{enabled:!0}},responsive:[{breakpoint:280,options:{legend:{position:"bottom",offsetY:0}}}],plotOptions:{bar:{horizontal:!1,columnWidth:"50%"}},dataLabels:{enabled:!1},yaxis:{labels:{offsetX:-15,formatter:e=>e/1+"K"},min:-30,max:30,tickAmount:6},xaxis:{categories:[" 25 Jan ","26 Jan","27 Jan","28 Jan","29 Jan","30 Jan","31 Jan"]},legend:{show:!1},fill:{opacity:1}},this.statistics_chart={chart:{type:"heatmap",height:360},plotOptions:{heatmap:{radius:100,enableShades:!1,colorScale:{ranges:[{from:0,to:0,color:"#E7F1F3"},{from:1,to:20,color:"#127384"}]}}},legend:{show:!1},dataLabels:{enabled:!1},stroke:{width:5,colors:["#fff"]},grid:{show:!1,borderColor:"#333",strokeDashArray:7,xaxis:{lines:{show:!1}},padding:{top:-30,bottom:0,left:0,right:-20}},xaxis:{axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{offsetX:-15}},series:[{name:"08 AM",data:[{x:"25 Jan",y:0},{x:"26 Jan",y:0},{x:"27 Jan",y:2},{x:"28 Jan",y:0},{x:"29 Jan",y:0},{x:"30 Jan",y:3}]},{name:"10 Am",data:[{x:"25 Jan",y:2},{x:"26 Jan",y:0},{x:"27 Jan",y:4},{x:"28 Jan",y:3},{x:"29 Jan",y:0},{x:"30 Jan",y:0}]},{name:"12 PM",data:[{x:"25 Jan",y:0},{x:"26 Jan",y:0},{x:"27 Jan",y:3},{x:"28 Jan",y:0},{x:"29 Jan",y:0},{x:"30 Jan",y:2}]},{name:"02 PM",data:[{x:"25 Jan",y:0},{x:"26 Jan",y:1},{x:"27 Jan",y:0},{x:"28 Jan",y:5},{x:"29 Jan",y:0},{x:"30 Jan",y:0}]},{name:"04 PM",data:[{x:"25 Jan",y:2},{x:"26 Jan",y:0},{x:"27 Jan",y:0},{x:"28 Jan",y:0},{x:"29 Jan",y:3},{x:"30 Jan",y:0}]},{name:"06 PM",data:[{x:"25 Jan",y:2},{x:"26 Jan",y:0},{x:"27 Jan",y:0},{x:"28 Jan",y:0},{x:"29 Jan",y:3},{x:"30 Jan",y:0}]},{name:"08 PM",data:[{x:"25 Jan",y:0},{x:"26 Jan",y:4},{x:"27 Jan",y:0},{x:"28 Jan",y:0},{x:"29 Jan",y:0},{x:"30 Jan",y:1}]},{name:"10 PM",data:[{x:"25 Jan",y:0},{x:"26 Jan",y:0},{x:"27 Jan",y:0},{x:"28 Jan",y:0},{x:"29 Jan",y:3},{x:"30 Jan",y:3}]}]}}ngOnDestroy(){window.clearTimeout(this.slider)}initializeMap(){let e={zoom:14,center:new google.maps.LatLng(53.470692,-2.220328),scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(document.getElementById("map"),e),this.map.slide=!0,this.infowindow=new google.maps.InfoWindow({content:"loading..."}),google.maps.event.addListener(this.infowindow,"closeclick",()=>{this.infowindow.close()}),this.setMarkers(),this.slider=window.setTimeout(()=>this.showRandomLocation(),3e3)}setMarkers(){this.locations.forEach(e=>{let r=new google.maps.LatLng(e.lat,e.lng),t=new google.maps.Marker({position:r,map:this.map,animation:google.maps.Animation.DROP,icon:"assets/admin/car-map.png"});this.bounds.extend(t.getPosition()),google.maps.event.addListener(t,"click",()=>{this.setInfoContent(e),this.infowindow.open(this.map,t),window.clearTimeout(this.slider)})}),this.map.fitBounds(this.bounds),google.maps.event.addListener(this.map,"zoom_changed",()=>{this.map.getZoom()>16&&(this.map.slide=!1)})}showRandomLocation(){if(!this.map.slide||this.locations.length===0)return;let e;do e=Math.floor(Math.random()*this.locations.length);while(e===this.current);this.current=e;let r=this.locations[e];this.setInfoContent(r),this.infowindow.open(this.map,null)}setInfoContent(e){let r=`
      <div class="card border-0 mb-0" style="width: 100%; display: inline-block;">
	<div class="card-body pt-0 p-2 d-flex align-items-center justify-content-between gap-3">
		<div class="d-flex align-items-center">
			<a href=  ${e.profile_link} class="avatar flex-shrink-0 me-2avatar-rounded" tabindex="0" target="_blank">
				<img class="img-fluid" alt=" ${e.car_name} " src=" ${e.image}">'
			</a>
			<div class="ms-2">
				<h6 class="fs-14 fw-semibold mb-1">
					<a href=" ${e.profile_link} " tabindex="0"> ${e.car_name}</a>
				</h6>
				<p class="fs-13">  ${e.speciality} </p>
			</div>
		</div>
		<div>
			<a  href="  ${e.profile_link} " tabindex="0" class="text-decoration-underline fw-medium link-violet">View</a>
		</div>
	</div>
</div>`;this.infowindow.setContent(r)}loadUserInfo(){let e=this.authService.getUserInfo();if(e)e.first_name||e.last_name?this.userName=`${e.first_name||""} ${e.last_name||""}`.trim():this.userName=e.username||"User";else{let r=this.authService.getToken();r&&this.apiService.getUserInfo(r).subscribe({next:t=>{t&&(this.authService.setUserInfo(t),t.first_name||t.last_name?this.userName=`${t.first_name||""} ${t.last_name||""}`.trim():this.userName=t.username||"User")},error:t=>{console.error("Error fetching user info:",t)}})}}loadCarCount(){this.isLoadingCars=!0;let e=new Date,r=this.getWeekStart(e),t=this.getWeekEnd(e),m=new Date(r);m.setDate(m.getDate()-7);let c=new Date(t);c.setDate(c.getDate()-7);let g=f=>{let A=String(f.getDate()).padStart(2,"0"),x=String(f.getMonth()+1).padStart(2,"0"),y=f.getFullYear();return`${A}/${x}/${y}`},p=g(r),v=g(t),_=g(m),b=g(c),k={page:0,sortBy:"Descending",fromDate:"",toDate:"",status:"",pageSize:1e4},M={page:0,sortBy:"Descending",fromDate:p,toDate:v,status:"",pageSize:1e4},F={page:0,sortBy:"Descending",fromDate:_,toDate:b,status:"",pageSize:1e4};this.apiService.getCarsFilter(k).subscribe({next:f=>{let A=f&&Array.isArray(f)?f.filter(x=>x.carStatus&&x.carStatus.toUpperCase()!=="DELETED").length:0;this.totalCars=A,this.apiService.getCarsFilter(M).subscribe({next:x=>{let y=x&&Array.isArray(x)?x.filter(S=>S.carStatus&&S.carStatus.toUpperCase()!=="DELETED").length:0;this.apiService.getCarsFilter(F).subscribe({next:S=>{this.isLoadingCars=!1;let L=S&&Array.isArray(S)?S.filter(D=>D.carStatus&&D.carStatus.toUpperCase()!=="DELETED").length:0;L>0?this.carPercentageChange=Math.round((y-L)/L*100):y>0?this.carPercentageChange=100:this.carPercentageChange=0},error:S=>{this.isLoadingCars=!1,console.error("Error fetching previous week cars:",S),this.carPercentageChange=0}})},error:x=>{this.isLoadingCars=!1,console.error("Error fetching current week cars:",x),this.carPercentageChange=0}})},error:f=>{this.isLoadingCars=!1,console.error("Error fetching all cars:",f),this.totalCars=0,this.carPercentageChange=0}})}loadReservationStats(){this.isLoadingReservations=!0;let e=new Date,r=this.getWeekStart(e),t=this.getWeekEnd(e),m=new Date(r);m.setDate(m.getDate()-7);let c=new Date(t);c.setDate(c.getDate()-7);let g=f=>{let A=String(f.getDate()).padStart(2,"0"),x=String(f.getMonth()+1).padStart(2,"0"),y=f.getFullYear();return`${A}/${x}/${y}`},p=g(r),v=g(t),_=g(m),b=g(c),k={page:0,sortBy:"Descending",fromDate:"",toDate:"",status:"",pageSize:1e4},M={page:0,sortBy:"Descending",fromDate:p,toDate:v,status:"",pageSize:1e4},F={page:0,sortBy:"Descending",fromDate:_,toDate:b,status:"",pageSize:1e4};this.apiService.getReservationsFilter(k).subscribe({next:f=>{let A=f?.data||f||[],x=Array.isArray(A)?A.filter(y=>y.status&&y.status.toUpperCase()!=="DELETED").length:0;this.totalReservations=x,this.apiService.getReservationsFilter(M).subscribe({next:y=>{let S=y?.data||y||[],L=Array.isArray(S)?S.filter(D=>D.status&&D.status.toUpperCase()!=="DELETED").length:0;this.apiService.getReservationsFilter(F).subscribe({next:D=>{this.isLoadingReservations=!1;let U=D?.data||D||[],W=Array.isArray(U)?U.filter(O=>O.status&&O.status.toUpperCase()!=="DELETED").length:0;W>0?this.reservationPercentageChange=Math.round((L-W)/W*100):L>0?this.reservationPercentageChange=100:this.reservationPercentageChange=0},error:D=>{this.isLoadingReservations=!1,console.error("Error fetching previous week reservations:",D),this.reservationPercentageChange=0}})},error:y=>{this.isLoadingReservations=!1,console.error("Error fetching current week reservations:",y),this.reservationPercentageChange=0}})},error:f=>{this.isLoadingReservations=!1,console.error("Error fetching all reservations:",f),this.totalReservations=0,this.reservationPercentageChange=0}})}getWeekStart(e){let r=new Date(e),t=r.getDay(),m=r.getDate()-t+(t===0?-6:1),c=new Date(r.setDate(m));return c.setHours(0,0,0,0),c}getWeekEnd(e){let r=this.getWeekStart(e),t=new Date(r);return t.setDate(t.getDate()+6),t.setHours(23,59,59,999),t}loadCustomerCount(){this.isLoadingCustomers=!0;let e={page:0,sortBy:"Descending",fromDate:"",toDate:"",status:"",pageSize:1e4};this.apiService.getCustomersFilter(e).subscribe({next:r=>{this.isLoadingCustomers=!1;let t=r?.data||r||[],m=Array.isArray(t)?t.filter(c=>c.status&&c.status.toUpperCase()!=="DELETED").length:0;this.totalCustomers=m},error:r=>{this.isLoadingCustomers=!1,console.error("Error fetching all customers:",r),this.totalCustomers=0}})}loadNewlyAddedCar(){this.isLoadingNewCar=!0;let e={page:0,sortBy:"Descending",fromDate:"",toDate:"",status:"",pageSize:1e4};this.apiService.getCarsFilter(e).subscribe({next:r=>{if(this.isLoadingNewCar=!1,r&&Array.isArray(r)&&r.length>0){let t=r.filter(m=>m.carStatus&&m.carStatus.toUpperCase()!=="DELETED");t.sort((m,c)=>{let g=m.createdAt?new Date(m.createdAt).getTime():0;return(c.createdAt?new Date(c.createdAt).getTime():0)-g}),this.newlyAddedCar=t.length>0?t[0]:null}else this.newlyAddedCar=null},error:r=>{this.isLoadingNewCar=!1,console.error("Error fetching newly added car:",r),this.newlyAddedCar=null}})}navigateToCarDetails(){if(this.newlyAddedCar&&this.newlyAddedCar.id){let e={originalData:this.newlyAddedCar};sessionStorage.setItem("currentCarData",JSON.stringify(e)),this.router.navigate(["/admin/car-details-edit",this.newlyAddedCar.id.toString(),"view"])}}loadRecentReservations(){this.isLoadingRecentReservations=!0;let e={page:0,sortBy:"Descending",fromDate:"",toDate:"",status:"",pageSize:1e4};this.apiService.getReservationsFilter(e).subscribe({next:r=>{this.isLoadingRecentReservations=!1;let t=r?.data||r||[];if(Array.isArray(t)){let m=t.filter(c=>c.status&&c.status.toUpperCase()!=="DELETED");m.sort((c,g)=>{let p=c.createdAt?new Date(c.createdAt).getTime():0;return(g.createdAt?new Date(g.createdAt).getTime():0)-p}),this.recentReservations=m.slice(0,5),this.recentReservations.forEach(c=>{if(c.carId){let g=c.carId.toString();this.apiService.getCarByUUID(g).subscribe({next:p=>{p&&p.length>0&&(c.carDetails=p[0])},error:p=>{console.error("Error fetching car details for reservation:",p)}})}})}else this.recentReservations=[]},error:r=>{this.isLoadingRecentReservations=!1,console.error("Error fetching recent reservations:",r),this.recentReservations=[]}})}loadRecentCustomers(){this.isLoadingRecentCustomers=!0;let e={page:0,sortBy:"Descending",fromDate:"",toDate:"",status:"",pageSize:1e4};this.apiService.getCustomersFilter(e).subscribe({next:r=>{let t=r?.data||r||[];if(Array.isArray(t)){let m=t.filter(p=>p.status&&p.status.toUpperCase()!=="DELETED");m.sort((p,v)=>{let _=p.createdAt?new Date(p.createdAt).getTime():0;return(v.createdAt?new Date(v.createdAt).getTime():0)-_});let c=m.slice(0,5),g={page:0,sortBy:"Descending",fromDate:"",toDate:"",status:"",pageSize:1e4};this.apiService.getReservationsFilter(g).subscribe({next:p=>{this.isLoadingRecentCustomers=!1;let v=p?.data||p||[];if(Array.isArray(v)){let _={};v.forEach(b=>{if(b.customerId&&b.status&&b.status.toUpperCase()!=="DELETED"){let k=b.customerId.toString();_[k]=(_[k]||0)+1}}),this.recentCustomers=c.map(b=>R(T({},b),{bookingCount:_[b.id?.toString()]||0}))}else this.recentCustomers=c.map(_=>R(T({},_),{bookingCount:0}))},error:p=>{this.isLoadingRecentCustomers=!1,console.error("Error fetching reservations for booking counts:",p),this.recentCustomers=c.map(v=>R(T({},v),{bookingCount:0}))}})}else this.isLoadingRecentCustomers=!1,this.recentCustomers=[]},error:r=>{this.isLoadingRecentCustomers=!1,console.error("Error fetching recent customers:",r),this.recentCustomers=[]}})}formatDate(e){if(!e)return"N/A";let r=new Date(e),t=String(r.getDate()).padStart(2,"0"),m=r.toLocaleString("default",{month:"short"}),c=r.getFullYear(),g=String(r.getHours()).padStart(2,"0"),p=String(r.getMinutes()).padStart(2,"0"),v=r.getHours()>=12?"PM":"AM";return`${t} ${m} ${c}, ${g}:${p} ${v}`}calculateDays(e,r){if(!e||!r)return 0;let t=new Date(e),m=new Date(r),c=Math.abs(m.getTime()-t.getTime());return Math.ceil(c/(1e3*60*60*24))}getCarImage(e){return"assets/admin/assets/img/car/car.jpg"}getCustomerAvatar(){return"assets/admin/assets/img/profiles/avatar-05.jpg"}static{this.\u0275fac=function(r){return new(r||a)(P(he),P(pe),P(se))}}static{this.\u0275cmp=H({type:a,selectors:[["app-dashboard"]],viewQuery:function(r,t){if(r&1&&Z(ve,5),r&2){let m;G(m=ee())&&(t.chart=m.first)}},standalone:!1,decls:125,vars:57,consts:[[1,"content","pb-0"],[1,"d-md-flex","d-block","align-items-center","justify-content-between","page-breadcrumb","mb-3"],[1,"my-auto","mb-2"],[1,"mb-1"],[1,"breadcrumb","mb-0"],[1,"breadcrumb-item"],[3,"routerLink"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row"],[1,"col-xl-8","d-flex","flex-column"],[1,"card","flex-fill"],[1,"card-body"],[1,"row","align-items-center","row-gap-3"],[1,"col-sm-7"],[1,"d-flex","align-items-center","flex-wrap","gap-4","mb-3"],[4,"ngIf"],[1,"d-flex","align-items-center","gap-3","flex-wrap"],[1,"btn","btn-primary","d-flex","align-items-center",3,"routerLink"],[1,"ti","ti-eye","me-1"],[1,"col-sm-5"],["src","assets/admin/assets/img/icons/car.svg","alt","img"],[1,"col-md-4","d-flex"],[1,"card-body","pb-1"],[1,"border-bottom","mb-0","pb-2"],[1,"d-flex","align-items-center"],[1,"avatar","avatar-sm","bg-secondary-100","text-secondary","me-2"],[1,"ti","ti-calendar-time","fs-14"],[1,"d-flex","align-items-center","justify-content-between","gap-2"],[1,"py-2"],["class","mb-1",4,"ngIf"],[3,"series","chart","colors","fill","xaxis","stroke","tooltip","dataLabels"],[1,"avatar","avatar-sm","bg-orange-100","text-orange","me-2"],[1,"ti","ti-users","fs-14"],[1,"avatar","avatar-sm","bg-violet-100","text-violet","me-2"],[1,"ti","ti-car","fs-14"],[1,"col-xl-4","d-flex"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap","gap-2","mb-3"],[1,"text-decoration-underline","fw-medium",3,"routerLink"],["class","mb-2",4,"ngIf"],["class","d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3",4,"ngIf"],["class","row g-2 justify-content-center mb-3",4,"ngIf"],["class","btn btn-white d-flex align-items-center justify-content-center","style","cursor: pointer;",3,"click",4,"ngIf"],["class","text-center",4,"ngIf"],[1,"col-xl-12","d-flex"],[1,"d-flex","align-items-center","justify-content-between","flex-wrap","gap-2","mb-1"],[1,"table-responsive"],["class","table custom-table1",4,"ngIf"],["class","text-center p-3",4,"ngIf"],[1,"fw-semibold"],[1,"fw-semibold","me-1"],[1,"mb-2"],["alt","img","onerror","this.src='assets/admin/assets/img/car/car.jpg'",1,"rounded","w-100",3,"src"],[1,"rounded","w-100","bg-light",2,"height","200px","display","flex","align-items","center","justify-content","center"],[1,"fs-13","mb-1"],[1,"fs-14","fw-semibold"],["class","fs-14 fw-semibold",4,"ngIf"],[1,"fw-normal","text-gray-5"],[1,"row","g-2","justify-content-center","mb-3"],[1,"col-sm-4","col-6","d-flex"],[1,"bg-light","border","p-2","br-5","flex-fill","text-center"],[1,"fs-13"],[1,"btn","btn-white","d-flex","align-items-center","justify-content-center",2,"cursor","pointer",3,"click"],[1,"ti","ti-chevron-right","ms-1"],[1,"text-center"],[1,"table","custom-table1"],[4,"ngFor","ngForOf"],[1,"avatar","flex-shrink-0",3,"routerLink"],["alt","img","onerror","this.src='assets/admin/assets/img/car/car.jpg'",3,"src"],[1,"flex-grow-1","ms-2"],[1,"d-flex","align-items-center","fs-13","text-default","mb-1"],[1,"ti","ti-circle-filled","text-primary","fs-5","mx-1"],[1,"fs-14","fw-semibold","mb-1"],["class","d-flex align-items-center gap-1 mb-1",4,"ngIf"],["class","fs-13 text-default",4,"ngIf"],[1,"d-flex","align-items-center","gap-3"],["href","javascript:void(0);",1,"avatar","avatar-sm"],["alt","img",1,"rounded-circle",3,"src"],[1,"d-flex","align-items-center","gap-1","mb-1"],[1,"fs-13","text-default"],[1,"fw-normal","text-default"],[1,"text-center","p-3"],["alt","","onerror","this.src='assets/admin/assets/img/profiles/avatar-05.jpg'",1,"rounded-circle",3,"src"],[1,"badge","badge-sm","bg-secondary-transparent","rounded-pill"],[1,"text-end"],[1,"fs-13","mb-1","text-default"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4",3),o(4,"Dashboard"),i(),n(5,"nav")(6,"ol",4)(7,"li",5)(8,"a",6),o(9,"Home"),i()(),n(10,"li",7),o(11," Admin Dashboard "),i()()()()(),n(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11)(16,"div",12)(17,"div",13)(18,"h4",3),o(19),i(),n(20,"div",14)(21,"div")(22,"p",3),o(23,"Total No of Cars"),i(),C(24,xe,2,1,"h3",15)(25,ye,2,0,"h3",15),i()(),n(26,"div",16)(27,"a",17),u(28,"i",18),o(29,"Reservations"),i()()(),n(30,"div",19),u(31,"img",20),i()()()(),n(32,"div",8)(33,"div",21)(34,"div",10)(35,"div",22)(36,"div",23)(37,"div",24)(38,"span",25),u(39,"i",26),i(),n(40,"p"),o(41,"Total Reservations"),i()()(),n(42,"div",27)(43,"div",28),C(44,Ce,2,1,"h5",29)(45,be,2,0,"h5",29)(46,_e,4,4,"p",15)(47,Se,2,0,"p",15),i(),n(48,"div"),u(49,"apx-chart",30),i()()()()(),n(50,"div",21)(51,"div",10)(52,"div",22)(53,"div",23)(54,"div",24)(55,"span",31),u(56,"i",32),i(),n(57,"p"),o(58,"Total Customers"),i()()(),n(59,"div",27)(60,"div",28),C(61,we,2,1,"h5",29)(62,De,2,0,"h5",29)(63,Ee,2,0,"p",15),i(),n(64,"div"),u(65,"apx-chart",30),i()()()()(),n(66,"div",21)(67,"div",10)(68,"div",22)(69,"div",23)(70,"div",24)(71,"span",33),u(72,"i",34),i(),n(73,"p"),o(74,"Total Cars"),i()()(),n(75,"div",27)(76,"div",28),C(77,Ae,2,1,"h5",29)(78,ke,2,0,"h5",29)(79,Le,4,6,"p",15)(80,Ie,2,0,"p",15),i(),n(81,"div"),u(82,"apx-chart",30),i()()()()()()(),n(83,"div",35)(84,"div",10)(85,"div",11)(86,"div",36)(87,"h5"),o(88,"Newly Added Cars"),i(),n(89,"a",37),o(90,"View All"),i()(),C(91,Te,2,1,"div",38)(92,Re,4,0,"div",38)(93,Je,4,0,"div",38)(94,Ne,7,5,"div",39)(95,Me,19,3,"div",40)(96,Fe,3,0,"a",41)(97,We,3,0,"div",42)(98,je,3,0,"div",42),i()()()(),n(99,"div",8)(100,"div",43)(101,"div",10)(102,"div",22)(103,"div",44)(104,"h5"),o(105,"Recent Reservations"),i(),n(106,"a",37),o(107,"View All"),i()(),n(108,"div",45),C(109,Xe,2,1,"table",46)(110,qe,3,0,"div",47)(111,Ze,3,0,"div",47),i()()()()(),n(112,"div",8)(113,"div",35)(114,"div",10)(115,"div",22)(116,"div",44)(117,"h5"),o(118,"Customers"),i(),n(119,"a",37),o(120,"View All"),i()(),n(121,"div",45),C(122,et,2,1,"table",46)(123,tt,3,0,"div",47)(124,at,3,0,"div",47),i()()()()()()),r&2&&(s(8),l("routerLink",t.routes.homeNew),s(11),E("Welcome, ",t.userName,""),s(5),l("ngIf",!t.isLoadingCars),s(),l("ngIf",t.isLoadingCars),s(2),l("routerLink",t.routes.reservation),s(17),l("ngIf",!t.isLoadingReservations),s(),l("ngIf",t.isLoadingReservations),s(),l("ngIf",!t.isLoadingReservations),s(),l("ngIf",t.isLoadingReservations),s(2),l("series",t.Areachart.series)("chart",t.Areachart.chart)("colors",t.Areachart.colors)("fill",t.Areachart.fill)("xaxis",t.Areachart.xaxis)("stroke",t.Areachart.stroke)("tooltip",t.Areachart.tooltip)("dataLabels",t.Areachart.dataLabels),s(12),l("ngIf",!t.isLoadingCustomers),s(),l("ngIf",t.isLoadingCustomers),s(),l("ngIf",t.isLoadingCustomers),s(2),l("series",t.Areachart2.series)("chart",t.Areachart2.chart)("colors",t.Areachart2.colors)("fill",t.Areachart2.fill)("xaxis",t.Areachart2.xaxis)("stroke",t.Areachart2.stroke)("tooltip",t.Areachart2.tooltip)("dataLabels",t.Areachart2.dataLabels),s(12),l("ngIf",!t.isLoadingCars),s(),l("ngIf",t.isLoadingCars),s(),l("ngIf",!t.isLoadingCars),s(),l("ngIf",t.isLoadingCars),s(2),l("series",t.Areachart3.series)("chart",t.Areachart3.chart)("colors",t.Areachart3.colors)("fill",t.Areachart3.fill)("xaxis",t.Areachart3.xaxis)("stroke",t.Areachart3.stroke)("tooltip",t.Areachart3.tooltip)("dataLabels",t.Areachart3.dataLabels),s(7),l("routerLink",t.routes.cars),s(2),l("ngIf",!t.isLoadingNewCar&&t.newlyAddedCar),s(),l("ngIf",t.isLoadingNewCar),s(),l("ngIf",!t.isLoadingNewCar&&!t.newlyAddedCar),s(),l("ngIf",!t.isLoadingNewCar&&t.newlyAddedCar),s(),l("ngIf",!t.isLoadingNewCar&&t.newlyAddedCar),s(),l("ngIf",!t.isLoadingNewCar&&t.newlyAddedCar),s(),l("ngIf",t.isLoadingNewCar),s(),l("ngIf",!t.isLoadingNewCar&&!t.newlyAddedCar),s(8),l("routerLink",t.routes.reservation),s(3),l("ngIf",!t.isLoadingRecentReservations&&t.recentReservations.length>0),s(),l("ngIf",t.isLoadingRecentReservations),s(),l("ngIf",!t.isLoadingRecentReservations&&t.recentReservations.length===0),s(8),l("routerLink",t.routes.customers),s(3),l("ngIf",!t.isLoadingRecentCustomers&&t.recentCustomers.length>0),s(),l("ngIf",t.isLoadingRecentCustomers),s(),l("ngIf",!t.isLoadingRecentCustomers&&t.recentCustomers.length===0))},dependencies:[ae,ie,oe,ce,de,ne],encapsulation:2})}}return a})();var it=[{path:"",component:fe}],ue=(()=>{class a{static{this.\u0275fac=function(r){return new(r||a)}}static{this.\u0275mod=N({type:a})}static{this.\u0275inj=J({imports:[B.forChild(it),B]})}}return a})();var bt=(()=>{class a{static{this.\u0275fac=function(r){return new(r||a)}}static{this.\u0275mod=N({type:a})}static{this.\u0275inj=J({imports:[re,ue,me]})}}return a})();export{bt as DashboardModule};
